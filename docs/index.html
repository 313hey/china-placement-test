<!doctype html>
<html lang="zh">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>来华研学插班中文分级测评</title>
  <style>
    body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"PingFang SC","Microsoft YaHei",Arial,sans-serif;max-width:960px;margin:24px auto;padding:0 16px;background:#fff;}
    h1{margin:12px 0 8px}
    .muted{color:#666;font-size:14px;line-height:1.6}
    .card{border:1px solid #ddd;border-radius:14px;padding:16px;margin:12px 0;background:#fff;}
    .row{display:flex;gap:12px;flex-wrap:wrap;}
    input,select{padding:10px;border:1px solid #ccc;border-radius:10px;min-width:260px;background:#fff;}
    .btn{padding:12px 16px;border-radius:10px;border:1px solid #ddd;background:#fff;cursor:pointer}
    .btnPrimary{background:#111;color:#fff;border-color:#111}
    .btn:disabled{opacity:.5;cursor:not-allowed}
    .hint{margin-top:10px}
  </style>
</head>

<body>
  <h1>来华研学插班中文分级测评（在线）</h1>
  <p class="muted">请先填写信息，然后点击“开始考试”。考试分为：听力 → 阅读 → 书写，最后会跳转到成绩页。</p>

  <div class="card">
    <div class="row">
      <div>
        <div class="muted">姓名 Name</div>
        <input id="name" placeholder="例如：Alex" autocomplete="name" />
      </div>

      <div>
        <div class="muted">学校/项目 School</div>
        <select id="schoolSelect"></select>
      </div>
    </div>

    <div class="hint">
      <button id="startBtn" class="btn btnPrimary" disabled>开始考试</button>
      <span id="tip" class="muted" style="margin-left:10px;"></span>
    </div>
  </div>

  <script src="./questions.js"></script>
  <script>
    const nameEl = document.getElementById("name");
    const sel = document.getElementById("schoolSelect");
    const btn = document.getElementById("startBtn");
    const tip = document.getElementById("tip");

    // 填充项目下拉：来自 questions.js 里的 PROJECT_OPTIONS
    const opts = (typeof PROJECT_OPTIONS !== "undefined" && Array.isArray(PROJECT_OPTIONS)) ? PROJECT_OPTIONS : [];
    const fallback = [
      { value: "CIS", label: "CIS" },
      { value: "Hohhot", label: "Hohhot" },
    ];
    const finalOpts = opts.length ? opts : fallback;

    sel.innerHTML =
      '<option value="" disabled selected>请选择…</option>' +
      finalOpts.map(o => `<option value="${o.value}">${o.label}</option>`).join("");

    // 回填（如果用户刷新）
    nameEl.value = localStorage.getItem("quiz_name") || "";
    const savedSchool = localStorage.getItem("quiz_school") || "";
    if (savedSchool) sel.value = savedSchool;

    function update() {
      const ok = nameEl.value.trim() && sel.value;
      btn.disabled = !ok;
      tip.textContent = ok ? "" : "请填写姓名并选择项目";
    }
    nameEl.addEventListener("input", update);
    sel.addEventListener("change", update);

    btn.addEventListener("click", () => {
      localStorage.setItem("quiz_name", nameEl.value.trim());
      localStorage.setItem("quiz_school", sel.value);

      // 每次开始考试，重置答题状态（你也可以改成不重置）
      localStorage.setItem("quiz_startedAt", String(Date.now()));
      localStorage.setItem("quiz_currentSection", "listening");
      // 注意：不强制清空 answers，你想清空就打开下一行：
      // localStorage.removeItem("quiz_answers");

      // ✅ 用相对路径，避免出现 index.html/exam.html 那种坑
      window.location.href = "exam.html";
    });

    update();
  </script>
</body>
</html>
