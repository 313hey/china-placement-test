<!doctype html>
<html lang="zh">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>枫叶教育来华中文水平测试 / Maple Leaf Edu-Travel Chinese Placement Test</title>
  <style>
    :root{
      --bg:#f6f6f7;
      --card:#ffffff;
      --text:#111827;
      --muted:#6b7280;
      --muted2:#8b93a2;
      --border:rgba(17,24,39,.10);
      --shadow:0 18px 50px rgba(0,0,0,.08);
      --radius:20px;

      --red:#e11d48;
      --red2:#ff2d55;
      --redDark:#be123c;
      --focus:rgba(225,29,72,.22);

      --danger:#ef4444;
      --dangerBg:rgba(239,68,68,.10);
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"PingFang SC","Microsoft YaHei",Arial,sans-serif;
      background:
        radial-gradient(1100px 420px at 20% -10%, rgba(255,45,85,.16), transparent 65%),
        radial-gradient(900px 360px at 90% 0%, rgba(225,29,72,.12), transparent 55%),
        var(--bg);
      color:var(--text);
    }

    .wrap{max-width:920px;margin:0 auto;padding:22px 16px 44px;position:relative;}
    .header{
      display:flex;align-items:flex-start;gap:12px;flex-wrap:wrap;
      margin-bottom:14px;position:relative;
    }
    .logo{
      width:44px;height:44px;border-radius:14px;
      background:linear-gradient(135deg,var(--red2),var(--red));
      box-shadow:0 14px 30px rgba(225,29,72,.22);
      display:flex;align-items:center;justify-content:center;
      color:#fff;font-weight:900;font-size:16px;user-select:none;
      flex:0 0 auto;
    }
    h1{margin:0;font-size:20px;letter-spacing:.2px;line-height:1.25}
    .h1en{display:block;font-weight:750;color:rgba(17,24,39,.84);font-size:15px;margin-top:6px}
    .subtitle{margin-top:8px;color:var(--muted);font-size:14px}

    /* Maple watermark */
    .watermark{
      position:absolute;right:-40px;top:-40px;pointer-events:none;
      opacity:.055; /* 4–6% */
      width:240px;height:240px;
      filter:blur(0px);
    }

    .card{
      position:relative;
      background:var(--card);
      border:1px solid var(--border);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:18px;
      overflow:hidden;
    }
    /* Top gradient hairline */
    .card:before{
      content:"";
      position:absolute;left:0;top:0;right:0;height:2px;
      background:linear-gradient(90deg,var(--red2),var(--red));
    }

    label{display:block;margin:14px 0 8px}
    .labCN{font-weight:850;font-size:14.5px}
    .labEN{display:block;margin-top:4px;color:var(--muted2);font-size:12.5px;font-weight:650}

    input{
      width:100%;max-width:620px;
      padding:14px 14px;
      border-radius:16px;
      border:1px solid rgba(17,24,39,.14);
      font-size:15px;
      outline:none;
      background:#fff;
    }
    input:focus{
      border-color:rgba(225,29,72,.55);
      box-shadow:0 0 0 6px var(--focus);
    }
    .help{
      margin-top:6px;color:var(--muted2);font-size:12.5px;line-height:1.5;
    }
    .err{
      margin-top:6px;
      color:var(--redDark);
      font-size:13px;
      font-weight:800;
      display:none;
    }

    .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center;margin-top:18px}
    .btn{
      padding:12px 16px;border-radius:16px;border:1px solid rgba(17,24,39,.14);
      background:#fff;cursor:pointer;font-size:15px;
      transition:transform .06s ease, filter .15s ease, box-shadow .15s ease;
      user-select:none;
    }
    .btn:active{transform:translateY(1px)}
    .btnPrimary{
      background:linear-gradient(135deg,var(--red2),var(--red));
      border-color:transparent;color:#fff;font-weight:950;
      box-shadow:0 14px 26px rgba(225,29,72,.20);
    }
    .btnPrimary:hover{filter:saturate(1.05) brightness(1.02)}
    .btnSecondary{
      background:#fff;
      color:var(--muted);
    }

    .footer{
      margin-top:14px;
      color:var(--muted2);
      font-size:12.5px;
    }

    /* Modal */
    .overlay{
      position:fixed;inset:0;background:rgba(17,24,39,.45);
      display:none;align-items:center;justify-content:center;
      padding:18px;z-index:50;
    }
    .modal{
      width:min(600px, 100%);
      background:#fff;border-radius:22px;border:1px solid var(--border);
      box-shadow:0 26px 70px rgba(0,0,0,.22);
      padding:16px;
      transform:scale(.98);
      opacity:0;
      transition:transform .18s ease, opacity .18s ease;
    }
    .overlay.show .modal{transform:scale(1);opacity:1}
    .modal h2{margin:0;font-size:18px}
    .modal .sub{
      margin-top:6px;color:var(--muted);font-size:13.5px;line-height:1.6
    }
    .kv{
      margin-top:12px;border:1px solid var(--border);border-radius:16px;
      padding:12px;background:#fafafa;
      font-size:14px;line-height:1.7;
    }
    .kvRow{display:flex;gap:10px;flex-wrap:wrap;margin:6px 0}
    .kvKey{min-width:170px;font-weight:900}
    .kvKey .en{font-weight:750;color:var(--muted2)}
    .kvVal{font-weight:750;color:rgba(17,24,39,.88)}
    .modalActions{display:flex;gap:10px;flex-wrap:wrap;justify-content:flex-end;margin-top:14px}

    /* Small screen tweaks */
    @media (max-width:520px){
      .kvKey{min-width:100%}
    }
  </style>
</head>

<body>
  <div class="wrap">
    <!-- Watermark -->
    <svg class="watermark" viewBox="0 0 256 256" aria-hidden="true">
      <!-- Simple maple leaf outline -->
      <path fill="none" stroke="#111827" stroke-width="6" stroke-linecap="round" stroke-linejoin="round"
        d="M128 18c7 20 6 35 0 50 18-10 34-25 46-42 3 20-2 38-12 54 19-5 36-16 50-31-2 24-12 45-29 61 20 2 39-4 55-17-9 26-27 46-50 58 18 9 31 23 40 42-27-7-49-22-66-43 2 21-4 40-17 56-9-23-14-47-17-73h-2c-3 26-8 50-17 73-13-16-19-35-17-56-17 21-39 36-66 43 9-19 22-33 40-42-23-12-41-32-50-58 16 13 35 19 55 17-17-16-27-37-29-61 14 15 31 26 50 31-10-16-15-34-12-54 12 17 28 32 46 42-6-15-7-30 0-50z"/>
    </svg>

    <div class="header">
      <div class="logo">ML</div>
      <div>
        <h1>
          枫叶教育来华中文水平测试
          <span class="h1en">Maple Leaf Edu-Travel Chinese Placement Test</span>
        </h1>
        <div class="subtitle">请先填写信息 / Please fill in the info below</div>
      </div>
    </div>

    <div class="card">
      <!-- Name -->
      <label for="name">
        <span class="labCN">姓名（必填）</span>
        <span class="labEN">Name (Required)</span>
      </label>
      <input id="name" autocomplete="off" placeholder="例如：张三 / e.g., Zhang San" />
      <div id="err_name" class="err">请填写姓名 / Please enter name</div>

      <!-- Program -->
      <label for="program">
        <span class="labCN">项目（必填）</span>
        <span class="labEN">Program (Required)</span>
      </label>
      <input id="program" autocomplete="off" placeholder="例如：CIS Winter Camp / e.g., CIS Winter Camp" />
      <div id="err_program" class="err">请填写项目 / Please enter program</div>

      <!-- School -->
      <label for="school">
        <span class="labCN">学校（必填）</span>
        <span class="labEN">School (Required)</span>
      </label>
      <input id="school" autocomplete="off" placeholder="例如：Crofton House School / e.g., Crofton House School" />
      <div id="err_school" class="err">请填写学校 / Please enter school</div>

      <!-- Age -->
      <label for="age">
        <span class="labCN">年龄（必填）</span>
        <span class="labEN">Age (Required)</span>
      </label>
      <input id="age" inputmode="numeric" autocomplete="off" placeholder="例如：14 / e.g., 14" />
      <div class="help">范围：5–25 / Range: 5–25</div>
      <div id="err_age" class="err">年龄需为 5–25 的数字 / Age must be a number between 5 and 25</div>

      <!-- Email -->
      <label for="email">
        <span class="labCN">邮箱（选填）</span>
        <span class="labEN">Email (Optional)</span>
      </label>
      <input id="email" autocomplete="off" placeholder="例如：name@example.com / e.g., name@example.com" />
      <div id="err_email" class="err">邮箱格式不正确 / Invalid email format</div>

      <div class="row">
        <button id="startBtn" class="btn btnPrimary">开始测试 / Start Test</button>
      </div>

      <div class="footer">信息仅用于分级测评 / Used for placement only</div>
    </div>
  </div>

  <!-- Confirm Modal -->
  <div class="overlay" id="overlay">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <h2 id="modalTitle">确认信息 / Confirm Your Info</h2>
      <div class="sub">请核对后开始测试 / Please check before starting.</div>

      <div class="kv" id="kv"></div>

      <div class="modalActions">
        <button class="btn btnSecondary" id="editBtn">返回修改 / Edit</button>
        <button class="btn btnPrimary" id="confirmBtn">确认开始 / Confirm & Start</button>
      </div>
    </div>
  </div>

  <script>
    // Existing keys used by exam/app.js
    const LS = {
      name: "quiz_name",
      school: "quiz_school",
      answers: "quiz_answers",
      state: "quiz_state",
      result: "quiz_result",
      // optional extra fields (won't break anything)
      program: "quiz_program",
      schoolName: "quiz_school_name",
      age: "quiz_age",
      email: "quiz_email"
    };

    const $ = (id)=>document.getElementById(id);

    const el = {
      name: $("name"),
      program: $("program"),
      school: $("school"),
      age: $("age"),
      email: $("email"),
      startBtn: $("startBtn"),
      overlay: $("overlay"),
      kv: $("kv"),
      editBtn: $("editBtn"),
      confirmBtn: $("confirmBtn"),

      err_name: $("err_name"),
      err_program: $("err_program"),
      err_school: $("err_school"),
      err_age: $("err_age"),
      err_email: $("err_email"),
    };

    function showErr(node, yes){ node.style.display = yes ? "block" : "none"; }

    function isEmail(s){
      // simple but practical email check
      return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s);
    }

    function clearPreviousAttempt(){
      localStorage.removeItem(LS.answers);
      localStorage.removeItem(LS.state);
      localStorage.removeItem(LS.result);
    }

    function validate(){
      const v = {
        name: el.name.value.trim(),
        program: el.program.value.trim(),
        school: el.school.value.trim(),
        ageRaw: el.age.value.trim(),
        email: el.email.value.trim()
      };

      let ok = true;

      // Required
      const missingName = !v.name;
      const missingProgram = !v.program;
      const missingSchool = !v.school;

      showErr(el.err_name, missingName);
      showErr(el.err_program, missingProgram);
      showErr(el.err_school, missingSchool);

      if (missingName || missingProgram || missingSchool) ok = false;

      // Age numeric + range
      const age = Number(v.ageRaw);
      const ageOk = Number.isFinite(age) && Number.isInteger(age) && age >= 5 && age <= 25;
      showErr(el.err_age, !ageOk);
      if (!ageOk) ok = false;

      // Email optional but if present must be valid
      const emailOk = !v.email || isEmail(v.email);
      showErr(el.err_email, !emailOk);
      if (!emailOk) ok = false;

      // focus first invalid
      if (!ok){
        if (missingName) el.name.focus();
        else if (missingProgram) el.program.focus();
        else if (missingSchool) el.school.focus();
        else if (!ageOk) el.age.focus();
        else if (!emailOk) el.email.focus();
        return null;
      }

      return { name:v.name, program:v.program, school:v.school, age, email: v.email };
    }

    function esc(s){
      return (s ?? "").toString().replace(/[&<>"']/g, m => ({
        "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
      }[m]));
    }

    function openModal(){
      el.overlay.style.display = "flex";
      // trigger animation
      requestAnimationFrame(()=> el.overlay.classList.add("show"));
    }
    function closeModal(){
      el.overlay.classList.remove("show");
      // wait for animation
      setTimeout(()=>{ el.overlay.style.display="none"; }, 150);
    }

    // Start -> validate -> show confirm card
    el.startBtn.addEventListener("click", () => {
      const v = validate();
      if (!v) return;

      el.kv.innerHTML = `
        <div class="kvRow"><div class="kvKey">姓名 <span class="en">/ Name</span>:</div><div class="kvVal">${esc(v.name)}</div></div>
        <div class="kvRow"><div class="kvKey">项目 <span class="en">/ Program</span>:</div><div class="kvVal">${esc(v.program)}</div></div>
        <div class="kvRow"><div class="kvKey">学校 <span class="en">/ School</span>:</div><div class="kvVal">${esc(v.school)}</div></div>
        <div class="kvRow"><div class="kvKey">年龄 <span class="en">/ Age</span>:</div><div class="kvVal">${esc(String(v.age))}</div></div>
        <div class="kvRow"><div class="kvKey">邮箱 <span class="en">/ Email</span>:</div><div class="kvVal">${esc(v.email || "—")}</div></div>
      `;
      openModal();
    });

    el.editBtn.addEventListener("click", closeModal);

    // Confirm -> save -> clear previous attempt -> go exam
    el.confirmBtn.addEventListener("click", () => {
      const v = validate();
      if (!v) return;

      // Save required fields for exam page compatibility
      localStorage.setItem(LS.name, v.name);

      // Put program + school into quiz_school so existing exam header still shows meaningful info
      localStorage.setItem(LS.school, `${v.program} | ${v.school}`);

      // Optional extra fields (safe)
      localStorage.setItem(LS.program, v.program);
      localStorage.setItem(LS.schoolName, v.school);
      localStorage.setItem(LS.age, String(v.age));
      if (v.email) localStorage.setItem(LS.email, v.email);
      else localStorage.removeItem(LS.email);

      // Prevent串号: clear previous student's answers/progress/result
      clearPreviousAttempt();

      closeModal();
      location.href = "./exam.html";
    });

    // Close modal by clicking outside
    el.overlay.addEventListener("click", (e) => {
      if (e.target === el.overlay) closeModal();
    });

    // Light UX: hide errors when typing
    ["name","program","school","age","email"].forEach(k=>{
      el[k].addEventListener("input", ()=>{
        if (k==="name") showErr(el.err_name,false);
        if (k==="program") showErr(el.err_program,false);
        if (k==="school") showErr(el.err_school,false);
        if (k==="age") showErr(el.err_age,false);
        if (k==="email") showErr(el.err_email,false);
      });
    });
  </script>
</body>
</html>